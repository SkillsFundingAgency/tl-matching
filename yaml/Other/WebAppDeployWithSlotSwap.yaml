parameters:
- name: ARMSubscription
  type: string
- name: AppServiceName
  type: string
- name: ResourceGroupName
  type: string
- name: SlotName
  type: string
- name: DeploymentPackagePath
  type: string  
steps:
- task: AzureRmWebAppDeployment@3
  displayName: 'Azure App Service Deploy: $(AppServiceName)'
  inputs:
    azureSubscription: '$(ARMSubscription)'
    WebAppName: '$(AppServiceName)'
    DeployToSlotFlag: true
    ResourceGroupName: '$(ResourceGroupName)'
    SlotName: '$(SlotName)'
    Package: '$(DeploymentPackagePath)'
    UseWebDeploy: true
    RemoveAdditionalFilesFlag: true

- task: AzureAppServiceManage@0
  displayName: 'Start Azure App Service: $(AppServiceName)'
  inputs:
    azureSubscription: '$(ARMSubscription)'
    Action: 'Start Azure App Service'
    WebAppName: '$(AppServiceName)'
    SpecifySlotOrASE: true
    ResourceGroupName: '$(ResourceGroupName)'
    Slot: '$(SlotName)'

- task: AzureAppServiceManage@0
  displayName: 'Swap Slots: $(AppServiceName)'
  inputs:
    azureSubscription: '$(ARMSubscription)'
    WebAppName: '$(AppServiceName)'
    ResourceGroupName: '$(ResourceGroupName)'
    SourceSlot: '$(SlotName)'

- task: AzureAppServiceManage@0
  displayName: 'Stop Azure App Service: $(AppServiceName)'
  inputs:
    azureSubscription: '$(ARMSubscription)'
    Action: 'Stop Azure App Service'
    WebAppName: '$(AppServiceName)'
    SpecifySlotOrASE: true
    ResourceGroupName: '$(ResourceGroupName)'
    Slot: '$(SlotName)'
  condition: always()